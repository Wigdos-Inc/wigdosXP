<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wigdos XP</title>
    <link rel="icon" type="image/x-icon" href="assets/images/icons/16x/bombs.png">

    <!-- Global Stylesheets -->
    <link rel="stylesheet" href="styles/global/main.css">
    
    <!-- Page Stylesheets -->
    <link rel="stylesheet" href="styles/desktop/taskbar.css">
    <link rel="stylesheet" href="styles/desktop/window.css">
    <link rel="stylesheet" href="styles/desktop/lifecycle.css">
    <link rel="stylesheet" href="styles/desktop/desktop.css">
</head>
<body>
     
    <!-- cursor shit  sowwy if its too long >_<--> <!--  >:(  -->
    <style type="text/css">body { cursor: url('data:image/x-icon;base64,AAACAAEAICACAAAAAAAwAQAAFgAAACgAAAAgAAAAQAAAAAEAAQAAAAAAgAAAAAAAAAAAAAAAAgAAAAAAAAAAAAAA////AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAGAAAABgAAAAwAAAAMAAAAGAAAARgAAAGwAAAB8AAAAf4AAAH8AAAB+AAAAfAAAAHgAAABwAAAAYAAAAEAAAAAAAAAAAAAAAAAAAA/////////////////////////////////////////////////////////////////+f////D////w////4f///eH///zD///8Q////Af///wAf//8AP///AH///wD///8B////A////wf///8P////H////z////9/////////8='), auto; }</style>
     

    <main></main> <!-- Filled in by desktop.js -->


    <footer> <!-- Taskbar -->
        <div id="sm_btn"> <!-- sm = Start Menu -->
            <img src="assets/images/icons/16x/bombs.png" id="sm_btnImg">
            <p id="sm_btnText"><i><strong>start</strong></i></p>
        </div>

        <div id="qa_iconBox"> <!-- qa = Quick Access -->
            <div class="qa_icon" id="qa_icon1"></div>
            <div class="qa_icon" id="qa_icon2"></div>
        </div>

        <div id="ts_divider"></div> <!-- ts = Time Stuff -->
        <div id="ts_btn"></div>
    </footer>
    
    <!-- Firebase configuration with CORS fallback for local file access -->
    <script>
        // Check if ES6 modules are supported and not blocked by CORS
        if (window.location.protocol === 'file:') {
            // Load Firebase config without modules for local file access
            console.warn("Loading Firebase in compatibility mode for local file access");
            
            // Create fallback function for file:// protocol
            async function initializeFirebase() {
                console.warn("Firebase connection not available when running from file:// protocol - initializing offline mode");
                
                // Create mock Firebase API for offline use
                window.firebaseAPI = {
                    db: null,
                    auth: null,
                    setDoc: async () => { 
                        console.log("Mock setDoc called - data will be stored locally only");
                        return Promise.resolve();
                    },
                    getDoc: async () => {
                        console.log("Mock getDoc called - no remote data available");
                        return { exists: () => false };
                    },
                    doc: () => null,
                    createUserWithEmailAndPassword: async () => {
                        throw new Error("Account creation requires internet connection");
                    },
                    signInWithEmailAndPassword: async () => {
                        throw new Error("Online login requires internet connection");
                    },
                    collection: () => null,
                    getDocs: async () => {
                        console.log("Mock getDocs called - no remote data available");
                        return { docs: [] };
                    }
                };
                window.firebaseOnline = false;
                
                // Auto-login as guest if no user is stored
                if (!localStorage.getItem("username")) {
                    localStorage.setItem("username", "guest");
                }

                // Always dispatch dbReady event
                window.dispatchEvent(new Event("dbReady"));
            }
            
            // Initialize immediately for file:// protocol
            initializeFirebase();
        } else {
            // Load as module for http/https protocols
            const script = document.createElement('script');
            script.type = 'module';
            script.src = 'scripts/firebase/firebaseconfig.js';
            document.head.appendChild(script);
        }
    </script>

    <!-- Prep Scripts -->
    <script src="scripts/global/global.js"></script>
    <script src="scripts/desktop/lifecycle.js"></script>
    <script src="scripts/apps/appWindow.js"></script>
    <script src="scripts/apps/applications.js"></script>
    <script src="scripts/global/anticheat.js"></script>

    <!-- Content Scripts -->
    <script src="scripts/desktop/desktop.js"></script>
    <script src="scripts/desktop/taskbar.js"></script>
</body>
</html>