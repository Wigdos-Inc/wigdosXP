<!DOCTYPE html>
<html>
<head>
    <title>Simple Save System Test</title>
</head>
<body>
    <h1>Simple Save System Test</h1>
    <button onclick="testPushSave()">Push iframe save to Firestore</button>
    <button onclick="testLoadToIframe()">Load Firestore to iframe</button>
    <div id="output"></div>

    <!-- Test iframe -->
    <iframe id="gameIframe" src="data:text/html,<html><body><h2>Test Game Iframe</h2><script>localStorage.setItem('undertaleSaveData', JSON.stringify({level: 5, score: 1000}));</script></body></html>" width="400" height="200"></iframe>

    <script src="simple-save.js"></script>
    <script>
        // Mock WigdosXP Firebase API for testing
        window.firebaseAPI = {
            db: {},
            setDoc: async (doc, data, options) => {
                console.log('Mock Firebase save:', doc, data);
                document.getElementById('output').innerHTML += `<br>Saved to Firebase: ${JSON.stringify(data)}`;
                return Promise.resolve();
            },
            getDoc: async (doc) => {
                console.log('Mock Firebase load:', doc);
                return {
                    exists: () => true,
                    data: () => ({ undertale: '{"level": 10, "score": 2000}' })
                };
            },
            doc: (db, collection, docId) => {
                return { collection, docId };
            }
        };

        // Mock localStorage username
        localStorage.setItem('username', 'testuser');

        async function testPushSave() {
            try {
                const result = await pushIframeSaveToFirestore('undertale');
                document.getElementById('output').innerHTML = `Push result: ${result}`;
            } catch (error) {
                document.getElementById('output').innerHTML = `Push error: ${error.message}`;
            }
        }

        async function testLoadToIframe() {
            try {
                const result = await loadFirestoreToIframe('undertale');
                document.getElementById('output').innerHTML = `Load result: ${result}`;
            } catch (error) {
                document.getElementById('output').innerHTML = `Load error: ${error.message}`;
            }
        }
    </script>
</body>
</html>